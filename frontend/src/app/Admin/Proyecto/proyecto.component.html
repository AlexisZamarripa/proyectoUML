<!-- Contenedor principal -->
<div class="page-container" (click)="cerrarMenu()">
    <!-- Header de la página -->
    <div class="page-header">
        <div class="header-text">
            <h1 class="page-title">Mis Proyectos</h1>
            <p class="page-subtitle">Gestiona la documentación de tus proyectos de software</p>
        </div>
        <button class="btn btn-primary" (click)="abrirModalNuevoProyecto()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Nuevo Proyecto
        </button>
    </div>

    <!-- Grid de proyectos -->
    <div class="proyectos-grid" *ngIf="proyectos.length > 0">
        <div class="proyecto-card" *ngFor="let proyecto of proyectos">
            <div class="proyecto-header">
                <div class="proyecto-gradient" [ngClass]="proyecto.gradient">
                    <div class="menu-container">
                        <button class="btn-menu-proyecto" (click)="toggleMenu(proyecto.id, $event)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>

                        <!-- Menú desplegable -->
                        <div class="dropdown-menu" *ngIf="menuAbierto === proyecto.id"
                            (click)="$event.stopPropagation()">
                            <button class="dropdown-item" (click)="abrirModalEditar(proyecto.id)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                                Editar
                            </button>
                            <button class="dropdown-item dropdown-item-danger"
                                (click)="abrirModalConfirmacion(proyecto.id)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="proyecto-body">
                <h3 class="proyecto-nombre">{{ proyecto.nombre }}</h3>
                <p class="proyecto-descripcion">{{ proyecto.descripcion }}</p>

                <div class="proyecto-stats">
                    <div class="stat-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <span>Casos</span>
                    </div>
                    <div class="stat-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <span>Entrev.</span>
                    </div>
                    <div class="stat-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                            <polyline points="13 2 13 9 20 9"></polyline>
                        </svg>
                        <span>Docs</span>
                    </div>
                    <div class="stat-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        <span>UML</span>
                    </div>
                </div>
            </div>

            <div class="proyecto-footer">
                <button class="btn-abrir-proyecto" (click)="abrirProyecto(proyecto.id)">
                    Abrir Proyecto
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Estado vacío -->
    <div class="empty-state" *ngIf="proyectos.length === 0">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
        <h3>No tienes proyectos aún</h3>
        <p>Comienza creando tu primer proyecto de documentación</p>
    </div>
</div>

<!-- Modal para crear nuevo proyecto -->
<div class="modal-overlay" [class.active]="modalNuevoProyectoAbierto" (click)="cerrarModalNuevoProyecto()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 class="modal-title">Nuevo Proyecto</h2>
            <button class="modal-close" (click)="cerrarModalNuevoProyecto()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="modal-body">
            <form #formNuevoProyecto="ngForm">
                <div class="form-group full-width">
                    <label class="form-label required">Nombre del Proyecto</label>
                    <input type="text" class="form-input" placeholder="Ej: Sistema de Gestión de Inventarios"
                        [(ngModel)]="nuevoProyecto.nombre" name="nombre" required>
                </div>

                <div class="form-group full-width">
                    <label class="form-label required">Descripción</label>
                    <textarea class="form-textarea" placeholder="Describe brevemente el proyecto..." rows="4"
                        [(ngModel)]="nuevoProyecto.descripcion" name="descripcion" required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">Creado por</label>
                        <input type="text" class="form-input" placeholder="Tu nombre"
                            [(ngModel)]="nuevoProyecto.creador" name="creador" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Color del Proyecto</label>
                        <select class="form-select" [(ngModel)]="nuevoProyecto.gradient" name="gradient">
                            <option *ngFor="let gradient of gradientesDisponibles" [value]="gradient.value">
                                {{ gradient.label }}
                            </option>
                        </select>
                    </div>
                </div>
            </form>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="cerrarModalNuevoProyecto()">Cancelar</button>
            <button class="btn btn-primary" (click)="crearProyecto()">Crear Proyecto</button>
        </div>
    </div>
</div>

<!-- Modal para editar proyecto -->
<div class="modal-overlay" [class.active]="modalEditarProyectoAbierto" (click)="cerrarModalEditar()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 class="modal-title">Editar Proyecto</h2>
            <button class="modal-close" (click)="cerrarModalEditar()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="modal-body" *ngIf="proyectoEditando">
            <form #formEditarProyecto="ngForm">
                <div class="form-group full-width">
                    <label class="form-label required">Nombre del Proyecto</label>
                    <input type="text" class="form-input" placeholder="Ej: Sistema de Gestión de Inventarios"
                        [(ngModel)]="proyectoEditando.nombre" name="nombre" required>
                </div>

                <div class="form-group full-width">
                    <label class="form-label required">Descripción</label>
                    <textarea class="form-textarea" placeholder="Describe brevemente el proyecto..." rows="4"
                        [(ngModel)]="proyectoEditando.descripcion" name="descripcion" required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required">Creado por</label>
                        <input type="text" class="form-input" placeholder="Tu nombre"
                            [(ngModel)]="proyectoEditando.creador" name="creador" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Color del Proyecto</label>
                        <select class="form-select" [(ngModel)]="proyectoEditando.gradient" name="gradient">
                            <option *ngFor="let gradient of gradientesDisponibles" [value]="gradient.value">
                                {{ gradient.label }}
                            </option>
                        </select>
                    </div>
                </div>
            </form>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="cerrarModalEditar()">Cancelar</button>
            <button class="btn btn-primary" (click)="guardarEdicion()">Guardar Cambios</button>
        </div>
    </div>
</div>

<!-- Modal de confirmación de eliminación -->
<div class="modal-overlay" [class.active]="modalConfirmacionAbierto" (click)="cerrarModalConfirmacion()">
    <div class="modal-content modal-confirmacion" (click)="$event.stopPropagation()">

        <div class="modal-body text-center" *ngIf="proyectoAEliminar">
            <h2 class="confirmacion-title">¿Eliminar proyecto?</h2>
            <p class="confirmacion-mensaje">
                Estás a punto de eliminar el proyecto <strong>"{{ proyectoAEliminar.nombre }}"</strong>.
            </p>
            <p class="confirmacion-advertencia">
                Esta acción no se puede deshacer y se perderán todos los datos asociados.
            </p>
        </div>

        <div class="modal-footer modal-footer-center">
            <button class="btn btn-secondary" (click)="cerrarModalConfirmacion()">Cancelar</button>
            <button class="btn btn-danger" (click)="confirmarEliminacion()">Sí, eliminar proyecto</button>
        </div>
    </div>
</div>